{"version":"NotebookV1","origId":2811793003422291,"name":"Optimize Joins","language":"python","commands":[{"version":"CommandV1","origId":2811793003422292,"guid":"8daaeeb9-c5e0-4e68-90d8-96e9ec68c94a","subtype":"command","commandType":"auto","position":1.0,"command":"spark.conf.set(\"spark.sql.adaptive.enabled\", \"false\")","commandVersion":4,"state":"finished","results":{"type":"listResults","data":[],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1745077586791,"submitTime":1745077586722,"finishTime":1745077586957,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"tableResultSettingsMap":{},"nuid":"12239674-e429-4b2b-af8c-0024240a5990"},{"version":"CommandV1","origId":2811793003422294,"guid":"505f3fa1-0ded-484b-bdba-b02280006793","subtype":"command","commandType":"auto","position":2.0,"command":"# Big DataFrame\ndf_transactions = spark.createDataFrame([\n    (1, \"US\", 100),\n    (2, \"IN\", 200),\n    (3, \"UK\", 150),\n    (4, \"US\", 80),\n], [\"id\", \"country_code\", \"amount\"])\n\n# Small DataFrame\ndf_countries = spark.createDataFrame([\n    (\"US\", \"United States\"),\n    (\"IN\", \"India\"),\n    (\"UK\", \"United Kingdom\"),\n], [\"country_code\", \"country_name\"])","commandVersion":5,"state":"finished","results":{"type":"listResults","data":[],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"df_transactions","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"id","nullable":true,"type":"long"},{"metadata":{},"name":"country_code","nullable":true,"type":"string"},{"metadata":{},"name":"amount","nullable":true,"type":"long"}],"type":"struct"},"tableIdentifier":null},{"name":"df_countries","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"country_code","nullable":true,"type":"string"},{"metadata":{},"name":"country_name","nullable":true,"type":"string"}],"type":"struct"},"tableIdentifier":null}],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1745077633421,"submitTime":1745077633396,"finishTime":1745077635610,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"tableResultSettingsMap":{},"nuid":"2d21b68d-29e9-4d47-88d1-07f8c1d09a60"},{"version":"CommandV1","origId":4460376605093343,"guid":"3c9ab213-ba94-4803-9305-c49afe93300f","subtype":"command","commandType":"auto","position":3.0,"command":"df_transactions.display()","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"table","data":[[1,"US",100],[2,"IN",200],[3,"UK",150],[4,"US",80]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"id","type":"\"long\"","metadata":"{}"},{"name":"country_code","type":"\"string\"","metadata":"{}"},{"name":"amount","type":"\"long\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{},"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1745077652268,"submitTime":1745077652234,"finishTime":1745077654148,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["table",4]],"subcommandOptions":null,"contentSha256Hex":null,"tableResultSettingsMap":{},"nuid":"345ff23f-c070-4115-a512-e7add79d0b1a"},{"version":"CommandV1","origId":4460376605093344,"guid":"55c18ea4-297d-4138-88ba-b09450016462","subtype":"command","commandType":"auto","position":4.0,"command":"df_countries.display()","commandVersion":2,"state":"finished","results":{"type":"listResults","data":[{"type":"table","data":[["US","United States"],["IN","India"],["UK","United Kingdom"]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"country_code","type":"\"string\"","metadata":"{}"},{"name":"country_name","type":"\"string\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{},"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1745077664111,"submitTime":1745077664080,"finishTime":1745077664762,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["table",3]],"subcommandOptions":null,"contentSha256Hex":null,"tableResultSettingsMap":{},"nuid":"e2ec21de-aa72-4442-b947-273f2429d025"},{"version":"CommandV1","origId":4460376605093345,"guid":"ef0995e0-cf9c-4b19-b908-e96f8431bfe5","subtype":"command","commandType":"auto","position":5.0,"command":"df_join_opt = df_transactions.join(broadcast(df_countries),df_transactions['country_code']==df_countries['country_code'],\"inner\")","commandVersion":11,"state":"finished","results":{"type":"listResults","data":[],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"df_join_opt","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"id","nullable":true,"type":"long"},{"metadata":{},"name":"country_code","nullable":true,"type":"string"},{"metadata":{},"name":"amount","nullable":true,"type":"long"},{"metadata":{},"name":"country_code","nullable":true,"type":"string"},{"metadata":{},"name":"country_name","nullable":true,"type":"string"}],"type":"struct"},"tableIdentifier":null}],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1745077998515,"submitTime":1745077998486,"finishTime":1745077998662,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"tableResultSettingsMap":{},"nuid":"5f0dcf98-87fc-46c8-8e59-bf4f3f83c838"},{"version":"CommandV1","origId":4460376605093346,"guid":"6aebf699-6a5b-4f27-8f71-89c9f88c20b4","subtype":"command","commandType":"auto","position":6.0,"command":"df_join_opt.display()","commandVersion":2,"state":"finished","results":{"type":"listResults","data":[{"type":"table","data":[[1,"US",100,"US","United States"],[2,"IN",200,"IN","India"],[3,"UK",150,"UK","United Kingdom"],[4,"US",80,"US","United States"]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"id","type":"\"long\"","metadata":"{}"},{"name":"country_code","type":"\"string\"","metadata":"{}"},{"name":"amount","type":"\"long\"","metadata":"{}"},{"name":"country_code","type":"\"string\"","metadata":"{}"},{"name":"country_name","type":"\"string\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{},"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1745078002535,"submitTime":1745078002512,"finishTime":1745078004275,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["table",4]],"subcommandOptions":null,"contentSha256Hex":null,"tableResultSettingsMap":{},"nuid":"bf261168-8104-437a-81bf-af79636d9991"},{"version":"CommandV1","origId":4460376605093347,"guid":"b96630ff-96fa-422e-bf35-4ae1d67934ec","subtype":"command","commandType":"auto","position":7.0,"command":"","commandVersion":0,"state":"input","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"tableResultSettingsMap":{},"nuid":"44f5c3a3-6513-4631-b6ae-87611b78bb72"},{"version":"CommandV1","origId":4460376605093348,"guid":"4d68e26c-9cdc-4d17-8cc9-228abf97b060","subtype":"command","commandType":"auto","position":0.5,"command":"from pyspark.sql.functions import *\nspark.conf.set(\"spark.sql.adaptive.enabled\", \"false\")","commandVersion":2,"state":"finished","results":{"type":"listResults","data":[],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1745077995007,"submitTime":1745077994981,"finishTime":1745077995058,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"tableResultSettingsMap":{},"nuid":"e5cb6314-4b3d-45a4-b9c0-1a17a3f451ae"}],"dashboards":[],"guid":"18ddf25b-1bac-4db9-b304-7b31531c0145","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{"pythonIndentUnit":4},"reposExportFormat":"SOURCE","environmentMetadata":{"client":"1","base_environment":""},"computePreferences":null,"inputWidgetPreferences":null}