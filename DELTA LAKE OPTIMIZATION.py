{"version":"NotebookV1","origId":3037291105528902,"name":"DELTA LAKE OPTIMIZATION","language":"python","commands":[{"version":"CommandV1","origId":3037291105528903,"guid":"6c415c7a-236a-445b-83d3-fd3d0302f0e2","subtype":"command","commandType":"auto","position":1.0,"command":"%sql\nCREATE SCHEMA ansh_schema","commandVersion":2,"state":"finished","results":{"type":"listResults","data":[{"type":"table","data":[],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{},"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"_sqldf","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[],"type":"struct"},"tableIdentifier":null}],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1745096308609,"submitTime":1745096308575,"finishTime":1745096310282,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000,"implicitDf":true},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["table",0]],"subcommandOptions":null,"contentSha256Hex":null,"tableResultSettingsMap":{},"nuid":"ba893c49-67a3-4fe8-9387-5fe85fbe5f65"},{"version":"CommandV1","origId":3037291105528905,"guid":"3be68641-fa6d-4671-9b30-3a768b5d6a67","subtype":"command","commandType":"auto","position":2.0,"command":"%sql\nCREATE TABLE ansh_schema.anshtbl\n(\n  id INT,\n  salary INT\n)\nUSING DELTA \nLOCATION '/FileStore/rawdata/deltatbl'","commandVersion":9,"state":"finished","results":{"type":"listResults","data":[{"type":"table","data":[],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{},"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"_sqldf","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[],"type":"struct"},"tableIdentifier":null}],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1745096372730,"submitTime":1745096372704,"finishTime":1745096389496,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000,"implicitDf":true},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["table",0]],"subcommandOptions":null,"contentSha256Hex":null,"tableResultSettingsMap":{},"nuid":"650d4c12-75bb-4669-aa97-1c392994daad"},{"version":"CommandV1","origId":3037291105528906,"guid":"397c3f22-3078-4143-a344-2b38add8f549","subtype":"command","commandType":"auto","position":3.0,"command":"%sql\nINSERT INTO ansh_schema.anshtbl\nVALUES \n(5,100),\n(6,100)","commandVersion":6,"state":"finished","results":{"type":"listResults","data":[{"type":"table","data":[[2,2]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"num_affected_rows","type":"\"long\"","metadata":"{}"},{"name":"num_inserted_rows","type":"\"long\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{},"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"_sqldf","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"num_affected_rows","nullable":true,"type":"long"},{"metadata":{},"name":"num_inserted_rows","nullable":true,"type":"long"}],"type":"struct"},"tableIdentifier":null}],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1745096443955,"submitTime":1745096443926,"finishTime":1745096447865,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000,"implicitDf":true},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["table",1]],"subcommandOptions":null,"contentSha256Hex":null,"tableResultSettingsMap":{},"nuid":"2b70acb1-9cc3-4537-9de0-943fb3ea456c"},{"version":"CommandV1","origId":3037291105528907,"guid":"66d78a80-bde9-45a9-b839-fe2851c6dc8e","subtype":"command","commandType":"auto","position":4.0,"command":"%sql\nOPTIMIZE delta.`/FileStore/rawdata/deltatbl` ZORDER BY (id)","commandVersion":8,"state":"finished","results":{"type":"listResults","data":[{"type":"table","data":[["dbfs:/FileStore/rawdata/deltatbl",[1,3,[861,861,861.0,1,861],[845,845,845.0,3,2535],0,["minCubeSize(107374182400)",[0,0],[3,2535],0,[3,2535],1,null],1,3,0,false,0,0,1745096548746,1745096560267,8,1,null,[0,0],2,2,410]]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"path","type":"\"string\"","metadata":"{}"},{"name":"metrics","type":"{\"type\":\"struct\",\"fields\":[{\"name\":\"numFilesAdded\",\"type\":\"long\",\"nullable\":false,\"metadata\":{}},{\"name\":\"numFilesRemoved\",\"type\":\"long\",\"nullable\":false,\"metadata\":{}},{\"name\":\"filesAdded\",\"type\":{\"type\":\"struct\",\"fields\":[{\"name\":\"min\",\"type\":\"long\",\"nullable\":true,\"metadata\":{}},{\"name\":\"max\",\"type\":\"long\",\"nullable\":true,\"metadata\":{}},{\"name\":\"avg\",\"type\":\"double\",\"nullable\":false,\"metadata\":{}},{\"name\":\"totalFiles\",\"type\":\"long\",\"nullable\":false,\"metadata\":{}},{\"name\":\"totalSize\",\"type\":\"long\",\"nullable\":false,\"metadata\":{}}]},\"nullable\":true,\"metadata\":{}},{\"name\":\"filesRemoved\",\"type\":{\"type\":\"struct\",\"fields\":[{\"name\":\"min\",\"type\":\"long\",\"nullable\":true,\"metadata\":{}},{\"name\":\"max\",\"type\":\"long\",\"nullable\":true,\"metadata\":{}},{\"name\":\"avg\",\"type\":\"double\",\"nullable\":false,\"metadata\":{}},{\"name\":\"totalFiles\",\"type\":\"long\",\"nullable\":false,\"metadata\":{}},{\"name\":\"totalSize\",\"type\":\"long\",\"nullable\":false,\"metadata\":{}}]},\"nullable\":true,\"metadata\":{}},{\"name\":\"partitionsOptimized\",\"type\":\"long\",\"nullable\":false,\"metadata\":{}},{\"name\":\"zOrderStats\",\"type\":{\"type\":\"struct\",\"fields\":[{\"name\":\"strategyName\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"inputCubeFiles\",\"type\":{\"type\":\"struct\",\"fields\":[{\"name\":\"num\",\"type\":\"long\",\"nullable\":false,\"metadata\":{}},{\"name\":\"size\",\"type\":\"long\",\"nullable\":false,\"metadata\":{}}]},\"nullable\":true,\"metadata\":{}},{\"name\":\"inputOtherFiles\",\"type\":{\"type\":\"struct\",\"fields\":[{\"name\":\"num\",\"type\":\"long\",\"nullable\":false,\"metadata\":{}},{\"name\":\"size\",\"type\":\"long\",\"nullable\":false,\"metadata\":{}}]},\"nullable\":true,\"metadata\":{}},{\"name\":\"inputNumCubes\",\"type\":\"long\",\"nullable\":false,\"metadata\":{}},{\"name\":\"mergedFiles\",\"type\":{\"type\":\"struct\",\"fields\":[{\"name\":\"num\",\"type\":\"long\",\"nullable\":false,\"metadata\":{}},{\"name\":\"size\",\"type\":\"long\",\"nullable\":false,\"metadata\":{}}]},\"nullable\":true,\"metadata\":{}},{\"name\":\"numOutputCubes\",\"type\":\"long\",\"nullable\":false,\"metadata\":{}},{\"name\":\"mergedNumCubes\",\"type\":\"long\",\"nullable\":true,\"metadata\":{}}]},\"nullable\":true,\"metadata\":{}},{\"name\":\"numBatches\",\"type\":\"long\",\"nullable\":false,\"metadata\":{}},{\"name\":\"totalConsideredFiles\",\"type\":\"long\",\"nullable\":false,\"metadata\":{}},{\"name\":\"totalFilesSkipped\",\"type\":\"long\",\"nullable\":false,\"metadata\":{}},{\"name\":\"preserveInsertionOrder\",\"type\":\"boolean\",\"nullable\":false,\"metadata\":{}},{\"name\":\"numFilesSkippedToReduceWriteAmplification\",\"type\":\"long\",\"nullable\":false,\"metadata\":{}},{\"name\":\"numBytesSkippedToReduceWriteAmplification\",\"type\":\"long\",\"nullable\":false,\"metadata\":{}},{\"name\":\"startTimeMs\",\"type\":\"long\",\"nullable\":false,\"metadata\":{}},{\"name\":\"endTimeMs\",\"type\":\"long\",\"nullable\":false,\"metadata\":{}},{\"name\":\"totalClusterParallelism\",\"type\":\"long\",\"nullable\":false,\"metadata\":{}},{\"name\":\"totalScheduledTasks\",\"type\":\"long\",\"nullable\":false,\"metadata\":{}},{\"name\":\"autoCompactParallelismStats\",\"type\":{\"type\":\"struct\",\"fields\":[{\"name\":\"maxClusterActiveParallelism\",\"type\":\"long\",\"nullable\":true,\"metadata\":{}},{\"name\":\"minClusterActiveParallelism\",\"type\":\"long\",\"nullable\":true,\"metadata\":{}},{\"name\":\"maxSessionActiveParallelism\",\"type\":\"long\",\"nullable\":true,\"metadata\":{}},{\"name\":\"minSessionActiveParallelism\",\"type\":\"long\",\"nullable\":true,\"metadata\":{}}]},\"nullable\":true,\"metadata\":{}},{\"name\":\"deletionVectorStats\",\"type\":{\"type\":\"struct\",\"fields\":[{\"name\":\"numDeletionVectorsRemoved\",\"type\":\"long\",\"nullable\":false,\"metadata\":{}},{\"name\":\"numDeletionVectorRowsRemoved\",\"type\":\"long\",\"nullable\":false,\"metadata\":{}}]},\"nullable\":true,\"metadata\":{}},{\"name\":\"numTableColumns\",\"type\":\"long\",\"nullable\":false,\"metadata\":{}},{\"name\":\"numTableColumnsWithStats\",\"type\":\"long\",\"nullable\":false,\"metadata\":{}},{\"name\":\"totalTaskExecutionTimeMs\",\"type\":\"long\",\"nullable\":false,\"metadata\":{}}]}","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{},"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"_sqldf","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"path","nullable":true,"type":"string"},{"metadata":{},"name":"metrics","nullable":true,"type":{"fields":[{"metadata":{},"name":"numFilesAdded","nullable":false,"type":"long"},{"metadata":{},"name":"numFilesRemoved","nullable":false,"type":"long"},{"metadata":{},"name":"filesAdded","nullable":true,"type":{"fields":[{"metadata":{},"name":"min","nullable":true,"type":"long"},{"metadata":{},"name":"max","nullable":true,"type":"long"},{"metadata":{},"name":"avg","nullable":false,"type":"double"},{"metadata":{},"name":"totalFiles","nullable":false,"type":"long"},{"metadata":{},"name":"totalSize","nullable":false,"type":"long"}],"type":"struct"}},{"metadata":{},"name":"filesRemoved","nullable":true,"type":{"fields":[{"metadata":{},"name":"min","nullable":true,"type":"long"},{"metadata":{},"name":"max","nullable":true,"type":"long"},{"metadata":{},"name":"avg","nullable":false,"type":"double"},{"metadata":{},"name":"totalFiles","nullable":false,"type":"long"},{"metadata":{},"name":"totalSize","nullable":false,"type":"long"}],"type":"struct"}},{"metadata":{},"name":"partitionsOptimized","nullable":false,"type":"long"},{"metadata":{},"name":"zOrderStats","nullable":true,"type":{"fields":[{"metadata":{},"name":"strategyName","nullable":true,"type":"string"},{"metadata":{},"name":"inputCubeFiles","nullable":true,"type":{"fields":[{"metadata":{},"name":"num","nullable":false,"type":"long"},{"metadata":{},"name":"size","nullable":false,"type":"long"}],"type":"struct"}},{"metadata":{},"name":"inputOtherFiles","nullable":true,"type":{"fields":[{"metadata":{},"name":"num","nullable":false,"type":"long"},{"metadata":{},"name":"size","nullable":false,"type":"long"}],"type":"struct"}},{"metadata":{},"name":"inputNumCubes","nullable":false,"type":"long"},{"metadata":{},"name":"mergedFiles","nullable":true,"type":{"fields":[{"metadata":{},"name":"num","nullable":false,"type":"long"},{"metadata":{},"name":"size","nullable":false,"type":"long"}],"type":"struct"}},{"metadata":{},"name":"numOutputCubes","nullable":false,"type":"long"},{"metadata":{},"name":"mergedNumCubes","nullable":true,"type":"long"}],"type":"struct"}},{"metadata":{},"name":"numBatches","nullable":false,"type":"long"},{"metadata":{},"name":"totalConsideredFiles","nullable":false,"type":"long"},{"metadata":{},"name":"totalFilesSkipped","nullable":false,"type":"long"},{"metadata":{},"name":"preserveInsertionOrder","nullable":false,"type":"boolean"},{"metadata":{},"name":"numFilesSkippedToReduceWriteAmplification","nullable":false,"type":"long"},{"metadata":{},"name":"numBytesSkippedToReduceWriteAmplification","nullable":false,"type":"long"},{"metadata":{},"name":"startTimeMs","nullable":false,"type":"long"},{"metadata":{},"name":"endTimeMs","nullable":false,"type":"long"},{"metadata":{},"name":"totalClusterParallelism","nullable":false,"type":"long"},{"metadata":{},"name":"totalScheduledTasks","nullable":false,"type":"long"},{"metadata":{},"name":"autoCompactParallelismStats","nullable":true,"type":{"fields":[{"metadata":{},"name":"maxClusterActiveParallelism","nullable":true,"type":"long"},{"metadata":{},"name":"minClusterActiveParallelism","nullable":true,"type":"long"},{"metadata":{},"name":"maxSessionActiveParallelism","nullable":true,"type":"long"},{"metadata":{},"name":"minSessionActiveParallelism","nullable":true,"type":"long"}],"type":"struct"}},{"metadata":{},"name":"deletionVectorStats","nullable":true,"type":{"fields":[{"metadata":{},"name":"numDeletionVectorsRemoved","nullable":false,"type":"long"},{"metadata":{},"name":"numDeletionVectorRowsRemoved","nullable":false,"type":"long"}],"type":"struct"}},{"metadata":{},"name":"numTableColumns","nullable":false,"type":"long"},{"metadata":{},"name":"numTableColumnsWithStats","nullable":false,"type":"long"},{"metadata":{},"name":"totalTaskExecutionTimeMs","nullable":false,"type":"long"}],"type":"struct"}}],"type":"struct"},"tableIdentifier":null}],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1745096547666,"submitTime":1745096547640,"finishTime":1745096560926,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000,"implicitDf":true},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["table",1]],"subcommandOptions":null,"contentSha256Hex":null,"tableResultSettingsMap":{},"nuid":"9f61694f-cc54-44d7-a55c-b34455a964af"},{"version":"CommandV1","origId":3037291105528908,"guid":"33e47ece-fcc4-4b25-a519-9c4f1e8df1fc","subtype":"command","commandType":"auto","position":5.0,"command":"","commandVersion":0,"state":"input","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"tableResultSettingsMap":{},"nuid":"61e5153a-da19-4ee0-9142-1140e5edb1c4"}],"dashboards":[],"guid":"a59dccb7-3cbc-455c-9fc2-676fa94ee6ed","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{"pythonIndentUnit":4,"mostRecentlyExecutedCommandWithImplicitDF":{"commandId":3037291105528907,"dataframes":["_sqldf"]}},"reposExportFormat":"SOURCE","environmentMetadata":{"client":"1","base_environment":""},"computePreferences":null,"inputWidgetPreferences":null}