{"version":"NotebookV1","origId":4460376605093349,"name":"SPARK SQL Hints","language":"python","commands":[{"version":"CommandV1","origId":4460376605093350,"guid":"349c6321-6df5-4acc-a56f-2a579354fce2","subtype":"command","commandType":"auto","position":1.0,"command":"from pyspark.sql.functions import *\nspark.conf.set(\"spark.sql.adaptive.enabled\", \"false\")","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1745078174100,"submitTime":1745078174052,"finishTime":1745078174154,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"tableResultSettingsMap":{},"nuid":"48c7cee0-95e6-4988-b136-fec4d1f96427"},{"version":"CommandV1","origId":4460376605093352,"guid":"65690c1b-5e46-4a75-8839-ba0c7eb6a28e","subtype":"command","commandType":"auto","position":2.0,"command":"# Big DataFrame\ndf_transactions = spark.createDataFrame([\n    (1, \"US\", 100),\n    (2, \"IN\", 200),\n    (3, \"UK\", 150),\n    (4, \"US\", 80),\n], [\"id\", \"country_code\", \"amount\"])\n\n# Small DataFrame\ndf_countries = spark.createDataFrame([\n    (\"US\", \"United States\"),\n    (\"IN\", \"India\"),\n    (\"UK\", \"United Kingdom\"),\n], [\"country_code\", \"country_name\"])","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"df_transactions","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"id","nullable":true,"type":"long"},{"metadata":{},"name":"country_code","nullable":true,"type":"string"},{"metadata":{},"name":"amount","nullable":true,"type":"long"}],"type":"struct"},"tableIdentifier":null},{"name":"df_countries","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"country_code","nullable":true,"type":"string"},{"metadata":{},"name":"country_name","nullable":true,"type":"string"}],"type":"struct"},"tableIdentifier":null}],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1745078176377,"submitTime":1745078176355,"finishTime":1745078176958,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"tableResultSettingsMap":{},"nuid":"24b08e14-da72-446c-8ad1-a6ce7ead75e3"},{"version":"CommandV1","origId":4460376605093353,"guid":"ea44bffc-51d6-4a7f-a7d3-c3d4b07afea8","subtype":"command","commandType":"auto","position":3.0,"command":"df_transactions.createOrReplaceTempView(\"transactions\")\ndf_countries.createOrReplaceTempView(\"countries\")","commandVersion":8,"state":"finished","results":{"type":"listResults","data":[],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1745078257073,"submitTime":1745078257043,"finishTime":1745078257340,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"tableResultSettingsMap":{},"nuid":"2763011d-2250-41f1-82d5-6f125705d77b"},{"version":"CommandV1","origId":4460376605093354,"guid":"71803f5a-9162-4d63-a0cf-b5fdde291db8","subtype":"command","commandType":"auto","position":4.0,"command":"df_sql_opt = spark.sql(\n    '''SELECT /* broadcast(c) */ \n        * \nFROM transactions t \nJOIN countries c \nON t.country_code = c.country_code''')","commandVersion":30,"state":"finished","results":{"type":"listResults","data":[],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"df_sql_opt","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"id","nullable":true,"type":"long"},{"metadata":{},"name":"country_code","nullable":true,"type":"string"},{"metadata":{},"name":"amount","nullable":true,"type":"long"},{"metadata":{},"name":"country_code","nullable":true,"type":"string"},{"metadata":{},"name":"country_name","nullable":true,"type":"string"}],"type":"struct"},"tableIdentifier":null}],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1745078690762,"submitTime":1745078690725,"finishTime":1745078690908,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000,"implicitDf":true},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"tableResultSettingsMap":{},"nuid":"236b022d-46e0-40dd-8bdc-bb98186d634c"},{"version":"CommandV1","origId":4460376605093355,"guid":"4d492d42-943d-455b-a44b-e8ee02f3ca3c","subtype":"command","commandType":"auto","position":5.0,"command":"df_sql_opt.display()","commandVersion":2,"state":"finished","results":{"type":"listResults","data":[{"type":"table","data":[[1,"US",100,"US","United States"],[4,"US",80,"US","United States"],[2,"IN",200,"IN","India"],[3,"UK",150,"UK","United Kingdom"]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"id","type":"\"long\"","metadata":"{}"},{"name":"country_code","type":"\"string\"","metadata":"{}"},{"name":"amount","type":"\"long\"","metadata":"{}"},{"name":"country_code","type":"\"string\"","metadata":"{}"},{"name":"country_name","type":"\"string\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{},"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1745078691452,"submitTime":1745078691429,"finishTime":1745078696928,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["table",4]],"subcommandOptions":null,"contentSha256Hex":null,"tableResultSettingsMap":{},"nuid":"4cf22da7-cc81-45d4-8362-669469d6c980"},{"version":"CommandV1","origId":4460376605093356,"guid":"6ae51852-c0c4-4f7f-9a21-b753315a7149","subtype":"command","commandType":"auto","position":6.0,"command":"","commandVersion":0,"state":"input","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"tableResultSettingsMap":{},"nuid":"a2fff9da-3be7-4f58-b0b5-fc934363978f"}],"dashboards":[],"guid":"0669a5e0-3d4f-44fa-85d0-d4be7c7ec405","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{"pythonIndentUnit":4,"mostRecentlyExecutedCommandWithImplicitDF":{"commandId":-1,"dataframes":["_sqldf"]}},"reposExportFormat":"SOURCE","environmentMetadata":{"client":"1","base_environment":""},"computePreferences":null,"inputWidgetPreferences":null}